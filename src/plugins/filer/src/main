"---------------------------------
" vim:set ft=vim:
"
" 2014/09/05 ryo
" Filer plugin
"
" see => 
"---------------------------------

augroup filer
	autocmd!
	autocmd VimEnter * :call Toggle() | :call OutputNewTree()
	autocmd VimEnter * :cd $devroot
augroup END

nnoremap ß :call Toggle()<CR>

function! Toggle()
	if $isOpen == 0
		execute ':topleft 50 vsplit /vagrant/src/plugins/filer/workfiles/tree.filerworkfile'
		let $isOpen = 1
	else
		" focus
		execute ':write!'
		execute ':bdelete!'
		let $isOpen = 0
	endif
endfunction





source $plugins_filer/src/tree/conf/Loader

" ???
augroup filer_frank_tmp
	autocmd!
	autocmd BufEnter *.filerworkfile call KeyMapping()
	autocmd BufEnter *.filerworkfile set filetype=filerworkfile
	autocmd BufEnter *.filerworkfile set syntax=filerworkfile
augroup END

function! ActionEnter()
python <<EOM
entry = tree.findByCursor()

if entry.type.isFile():
	vim.command('execute "wincmd w"')
	vim.command(':edit %s' % entry.path.value)
EOM
endfunction

function! ActionReload()
	call OutputNewTree()
endfunction

function! OutputNewTree()
python <<EOM
import vim

root = vim.eval('$devroot')
tree = Tree(root)
tree.output()
EOM
endfunction

nnoremap √ :qa!<CR>
